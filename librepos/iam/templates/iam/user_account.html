{% extends 'base.html' %}

{% import "components/card.j2" as Card %}
{% import "components/forms.j2" as Form %}
{% import "iam/_user_card.j2" as UserCard %}

{% block sidenav %}
    {% include 'iam/_sidenav.html' %}
{% endblock %}

{% block breadcrumb %}
    {% include '_partials/breadcrumbs.html' %}
{% endblock %}

{% block main %}

    <section class="section">
        <div class="mx-4 row">

            <!-- Account Summary Card -->
            <div class="col s12 m4">
                {% call UserCard.sidebar(user, size='medium') %}
                    <div class="divider my-2"></div>
                    <div class="left-align">
                        {{ UserCard.stat_item('badge', 'Role', user.role.name|replace("_", " ")|title if user.role else "N/A") }}
                        <p class="mb-1">{{ UserCard.status_badge(user.status) }}</p>
                        {{ UserCard.stat_item('calendar_month', 'Member since', user.created_at.strftime('%b %d, %Y') if user.created_at else 'N/A') }}
                    </div>
                {% endcall %}
            </div>

            <div class="col s12 m8 row">

                <!-- Account Settings -->
                <div class="col s12">
                    <div class="card-panel">
                        {{ Card.panel_header('manage_accounts', 'Account Settings',
                            'Update username, email address, and role assignment.') }}

                        <form action="{{ url_for('iam.user_account', slug=user.slug) }}" method="post">
                            {{ Form.render_form(form, extra_wrappers={
                            'username': 'm6',
                            'email': 'm6',
                            'role_id': 'm12'
                        }) }}
                        </form>
                    </div>
                </div>

                <!-- Quick Actions -->
                <div class="col s12">
                    <div class="card-panel">
                        {{ Card.panel_header('bolt', 'Quick Actions') }}

                        <div class="row mb-0">
                            <div class="col s12 m6">
                                {{ Card.action_button('lock_reset', 'Reset Password', url_for('iam.reset_user_password', slug=user.slug)) }}
                            </div>
                            <div class="col s12 m6">
                                {{ Card.action_button('person', 'Edit Profile', url_for('iam.user_profile', slug=user.slug)) }}
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </section>

{% endblock %}
