{#
    Login History Table Partial

    Renders the user login history table with HTMX pagination.
    Used both for initial page load and HTMX partial updates.
#}
{% import "components/card.j2" as Card %}
{% import "components/pagination_htmx.j2" as Pagination %}

{# Loading indicator - shown during HTMX requests #}
<div class="htmx-indicator center-align py-2">
    <div class="preloader-wrapper small active">
        <div class="spinner-layer spinner-primary-only">
            <div class="circle-clipper left"><div class="circle"></div></div>
            <div class="gap-patch"><div class="circle"></div></div>
            <div class="circle-clipper right"><div class="circle"></div></div>
        </div>
    </div>
</div>

{% if login_history %}
    <table class="striped responsive-table">
        <thead>
            <tr>
                <th>Date & Time</th>
                <th>Status</th>
                <th>IP Address</th>
                <th>Device</th>
                <th>Location</th>
            </tr>
        </thead>
        <tbody>
            {% for record in login_history %}
                <tr>
                    <td>
                        {{ record.login_at.strftime('%b %d, %Y') }}<br>
                        <span class="grey-text" style="font-size: 0.85rem;">
                            {{ record.login_at.strftime('%H:%M:%S') }}
                        </span>
                    </td>
                    <td>
                        {{ Card.login_status(record.is_successful) }}
                        {% if not record.is_successful and record.failure_reason %}
                            <br>
                            <span class="grey-text" style="font-size: 0.8rem;">
                                {{ record.failure_reason }}
                            </span>
                        {% endif %}
                    </td>
                    <td>
                        <code style="font-size: 0.85rem;">{{ record.ip_address or 'Unknown' }}</code>
                    </td>
                    <td>
                        {% if record.browser or record.os %}
                            {{ record.browser or '' }}
                            {% if record.browser and record.os %}<br>{% endif %}
                            <span class="grey-text" style="font-size: 0.85rem;">
                                {{ record.os or '' }}
                            </span>
                        {% else %}
                            <span class="grey-text">Unknown</span>
                        {% endif %}
                    </td>
                    <td>
                        {% if record.city or record.country %}
                            {{ record.city or '' }}{% if record.city and record.country %}, {% endif %}{{ record.country or '' }}
                        {% else %}
                            <span class="grey-text">-</span>
                        {% endif %}
                    </td>
                </tr>
            {% endfor %}
        </tbody>
    </table>
    {{ Pagination.render(pagination, 'iam.user_login_history_table', '#history-content', {'slug': user.slug}) }}
{% else %}
    {{ Card.empty_state('history', 'No login history available.') }}
{% endif %}
