{% from "macros/ui_components.html" import render_icon, render_modal_button, render_form %}
<!--
This template contains Jinja2 macros for page layout components and complex composite UI elements.

Key responsibilities:
- Provides reusable layout structures like headers, footers, sidebars
- Defines complex composite components that combine multiple basic UI elements
- Handles overall page structure and layout organization
- Manages layout-specific styling and positioning

Components include:
- Page sections (header, content, footer)
- Layout grids and containers
- Navigation structures
- Complex content blocks and panels
-->


<!--========================-->
<!-- PAGE HEADER COMPONENTS -->
<!--========================-->

{#
Page Section Documentation:

Parameters:
- title: String representing the section header title text
  Optional - if not provided, only content area is rendered without header
  Rendered in bold text within an h4 heading element

- description: Optional string for additional descriptive text
  Rendered below title in grey text color
  Default is None

- count: Optional value to display item count
  Shows count in grey text next to title in parentheses
  Default is None

- button: Optional button element to display in header
  Renders button in right-aligned column next to title
  Default is None

Layout:
- Renders as a section element with "section" class
- Content wrapped in responsive container
- Header includes title row and optional description
- Content area wrapped in row with top margin
- Divider line separates header from content

Example usage:
{% call page_section("Users", description="Manage system users", count=users) %}
    Content goes here...
{% endcall %}
#}

{% macro page_section(title, description=None, count=None, button=None) %}
    <section class="section">
        <div class="container">
            {% if title %}
                <div class="section-header">
                    <div class="row mb-2">
                        <div class="col {{ 's8' if button else 's12' }}">
                            <h4 class="my-0">
                                <b>{{ title }}</b>
                                {% if count %}
                                    <span class="grey-text">({{ count|length }})</span>
                                {% endif %}
                            </h4>
                        </div>
                        {% if button %}
                            <div class="col s4 right-align">
                                {{ button }}
                            </div>
                        {% endif %}
                    </div>
                    {% if description %}
                        <p class="grey-text">{{ description|capitalize }}</p>
                    {% endif %}
                    <div class="divider"></div>
                </div>
            {% endif %}
            <div class="section-content row mt-4">
                {{ caller() }}
            </div>
        </div>
    </section>
{% endmacro %}


<!--==================-->
<!-- CARD COMPONENTS -->
<!--==================-->

{#
Icon Card Documentation:

Parameters:
- icon: String representing the Material Symbols icon name to display
  Used to render the main icon in the center of the card
  Must be a valid Material Symbols icon identifier

- text: String text to display below the icon
  Displays as heading text under the icon
  Can be truncated based on truncate_length parameter

- href: Optional URL for card link
  Makes entire card clickable and links to specified URL
  Default is "#" for no action

- truncate_length: Optional integer for text truncation
  Maximum length of displayed text before truncation
  Default is 12 characters

Layout:
- Renders as clickable card with centered content
- Large icon displayed above truncated text
- Hover effect provides visual feedback
- Inherits text color from parent

Example usage:
{{ render_icon_card("home", "Dashboard", href="/dashboard") }}
{{ render_icon_card("settings", "Configuration", truncate_length=15) }}
#}

{% macro render_icon_card(icon, text, href="#", truncate_length=12) %}
    {% set card_classes = "center-align hoverable" %}

    <a href="{{ href }}">
        {% call panel_card(classes=card_classes) %}
            {{ render_icon(icon, classes="large") }}
            <h4 class="mt-2">{{ text|truncate(length=truncate_length) }}</h4>
        {% endcall %}
    </a>

{% endmacro %}

{#
User Contact Card Documentation:

Parameters:
- user: User object containing contact information
  Required - provides user data to display in contact card
  Must include: role, image, full_name, and email attributes

Layout:
- Renders as elevated card with centered content
- Shows user role name in title case at top
- Displays profile image from static files
- Full name shown in white text below image
- Email address in grey text at bottom
- Uses MaterializeCSS card and text styling

Example usage:
{{ user_contact_card(user) }}
#}

{% macro user_contact_card(user) %}
    <div class="card z-depth-2">
        <div class="card-content center-align">
            <h5 class="mt-0 ">{{ user.role.name|title }}</h5>
            <img src="{{ url_for('static', filename=user.image|safe) }}" alt="Profile Photo"
                 class="profile-img">
            <h5 class="white-text"><b>{{ user.full_name }}</b></h5>
            <p class="grey-text">{{ user.email }}</p>
        </div>
    </div>
{% endmacro %}

{#
Panel Card Documentation:

Parameters:
- title: Optional string for card header title text
  Displays as heading at top of card
  Default is None (no header shown)

- classes: Optional string of CSS classes to apply
  Additional classes added to card container
  Default is empty string

- count: Optional value to show item count
  Displays count in grey text next to title
  Default is None

- button: Optional button element in header
  Renders button aligned right of title
  Default is None

Layout:
- Renders as card panel with elevation shadow
- Optional header with title and count
- Button displayed in right column if provided
- Divider line separates header from content
- Content area uses caller content

Example usage:
{% call panel_card("Users", count=users) %}
    Card content here...
{% endcall %}

{% call panel_card(classes="center-align") %}
    Centered content...
{% endcall %}

{% set add_button %}
    {{ render_button("Add New", "filled") }} <-- don't forget to import the render_button
{% endset %}
{% call panel_card("Items", button=add_button) %}
    Content with button in header...
{% endcall %}
#}

{% macro panel_card(title=None, classes='', count=None, button=None) %}
    <div class="card-panel z-depth-2 {{ classes }}">
        {% if title %}
            <div class="row">
                <div class="col {{ 's8' if button else 's12' }}">
                    <h4 class="my-2">
                        {{ title }}
                        {% if count %}
                            <span class="grey-text">({{ count|length|string }})</span>
                        {% endif %}
                    </h4>
                </div>
                {% if button %}
                    <div class="col s4 right-align">
                        {{ button }}
                    </div>
                {% endif %}
            </div>
            <div class="divider"></div>
        {% endif %}
        {{ caller() }}
    </div>
{% endmacro %}

{#
Profile Card Documentation:

Parameters:
- user: User object containing profile information
  Required - provides user data to display in card
  Must include: username, full_name, role, active status, image (optional),
  created_at and current_sign_in_on timestamps

Layout:
- Renders as panel card with two-row layout
- Left column shows profile image or default icon
- Right column displays user details:
- Full name (or N/A if not set)
- Role with title casing
- Active/Suspended status with color coding
- Bottom row shows dates in two columns:
- Account creation date
- Last active timestamp
- Uses MaterializeCSS grid and alignment classes

Example usage:
{{ render_profile_card(current_user) }}
 #}

{% macro render_profile_card(user) %}
    {% call panel_card() %}
        <div class="row valign-wrapper">
            <div class="col s4 center-align">
                {% if user.image %}
                    <img class="circle" src="{{ url_for('static', filename=user.image|safe) }}"
                         alt="{{ user.username }}" width="100" height="100">
                {% else %}
                    {{ render_icon('face', classes='large') }}
                {% endif %}
            </div>
            <div class="col s8">
                <h5 class="ml-2">{{ user.full_name|title if user.first_name else "N/A" }}</h5>
                <p class="ml-2">
                    Role &colon; &nbsp; <strong>{{ user.role.name|title }}</strong></p>
                <p>
                <p class="ml-2">
                    Status &colon; &nbsp;
                    {% if user.active %}
                        <strong class="success-text">Active</strong>
                    {% else %}
                        <strong class="danger-text">Suspended</strong>
                    {% endif %}
                </p>
            </div>
        </div>
        <div class="row valign-wrapper">
            <div class="col s6 center-align">
                <p>
                    Created Date &colon; &nbsp; <strong>{{ user.created_at|date }}</strong>
                </p>
            </div>
            <div class="col s6 center-align">
                <p>
                    Last Active &colon; &nbsp; <strong>{{ user.current_sign_in_on|date }}</strong>
                </p>
            </div>
        </div>
    {% endcall %}
{% endmacro %}


{#
Danger Zone Card Documentation:

Parameters:
- active: Boolean indicating if deletion is currently restricted
  When true, shows message that item must be inactive first
  When false, shows delete confirmation flow

- name: String name of the item to be deleted
  Used in button text, modal title and confirmation messages
  Displayed with title casing

- form: Form object for deletion confirmation
  Rendered in the confirmation modal
  Must include a confirmation field

- url: String URL to submit deletion form to
  Form submission endpoint for processing deletion

- message: Optional string for additional warning message
  Extra message shown in confirmation modal
  Default is None

Layout:
- Renders as panel card with danger zone styling
- Shows either restriction message or delete flow
- Delete flow includes:
  - Warning about irreversible action
  - Modal trigger button
  - Confirmation modal with:
    - Warning message
    - Confirmation prompt
    - Delete form

Example usage:
{{ danger_zone_card(
    category.active,
    "category",
    delete_form,
    url_for("menu.category.process_delete_category")
) }}
#}

{% macro danger_zone_card(active, name, form, url, message=None) %}

    {% call panel_card("Danger Zone", classes="danger-border") %}
        {% set button_text = "Delete " + name|string|title %}
        {% set modal_title = button_text + "?" %}
        {% if active %}
            <div class="row g-0">
                <div class="col s12">
                    <p class="flow-text center-align">
                        <strong class="danger-text">{{ name }} must be inactive before it can be
                            deleted.</strong>
                    </p>
                </div>
            </div>
        {% else %}
            <div class="row g-0 mt-4">
                <div class="col s12 m6">
                    <p class="flow-text">
                        <strong>This action is <u>irreversible</u>.</strong>
                        <br>
                        <strong>Are you sure you want to delete this {{ name }}?</strong>
                    </p>
                </div>
                <div class="col s12 m6">
                    {{ render_modal_button(button_text, "outlined", "deleteModal", classes="danger") }}
                    {% call modal("deleteModal", modal_title, "danger") %}
                        <p class="flow-text">
                            Deleting this {{ name }} will permanently remove it from the system. This action
                            cannot be
                            undone.
                        </p>
                        {% if message %}
                            <p class="flow-text danger-text">{{ message }}</p>
                        {% endif %}
                        <p class="flow-text">
                            Type <strong class="danger-text"><u>confirm</u></strong> to proceed with deletion.
                        </p>
                        {{ render_form(form, url) }}
                    {% endcall %}
                </div>
            </div>
        {% endif %}
    {% endcall %}

{% endmacro %}


<!--==================-->
<!-- MODAL COMPONENTS -->
<!--==================-->

{#
Modal Component Documentation:

Parameters:
- id: Required string for unique modal identifier
  Used as modal element ID and for triggering via popovertarget
  Must be unique across the page

- title: Required string for modal header text
  Displayed as heading in modal header section

- type: Required string indicating modal type/style
  Affects border color and icon shown in header
  Valid values: "info", "warning", "danger", or empty for default

- footer: Optional HTML content for modal footer
  Custom footer content replaces default close button
  Default is None (shows standard close button)

- classes: Optional string of additional CSS classes
  Extra classes added to modal container
  Default is empty string

Layout:
- Renders as modal dialog with header, content, footer
- Header shows icon and title with type-based styling
- Content area contains caller-provided content
- Footer has close button or custom content
- Uses MaterializeCSS modal classes and styling

Example usage:
{% call modal("confirm-delete", "Delete Item", "danger") %}
    <p>Are you sure you want to delete this item?</p>
{% endcall %}

{% set custom_footer %}
    <button class="btn-flat">Cancel</button>
    <button class="btn">Confirm</button>
{% endset %}
{% call modal("custom-modal", "Custom Footer", "info", footer=custom_footer) %}
    Modal content here...
{% endcall %}
#}

{% macro modal(id, title, type, footer=None, classes='') %}
    <div id="{{ id }}" class="modal {{ type }}-border {{ classes }}" popover>
        {{ render_modal_header(type, title) }}
        <div class="modal-content">
            {{ caller() }}
        </div>
        <div class="modal-footer">
            {% if footer %}
                <div class="flex space-around">
                    {{ footer }}
                </div>
            {% else %}
                <button class="waves-effect btn-flat grey-text" popovertarget="{{ id }}">Close</button>
            {% endif %}
        </div>
    </div>
{% endmacro %}

{#
Modal Header Documentation:

Parameters:
- type: Required string indicating modal type/style
  Used for text color and icon selection
  Valid values: "info", "warning", "danger", or empty for default

- title: Required string for modal title text
  Displayed as heading in modal header
  Centered in header area

Layout:
- Renders as modal header with centered content
- Shows type-based icon above title text
- Title displayed using h4 tag
- Divider line below with type-based color
- Uses MaterializeCSS text alignment classes

Example usage:
{{ render_modal_header("info", "Information") }}
{{ render_modal_header("warning", "Alert") }}
{{ render_modal_header("danger", "Delete Confirmation") }}
#}

{% macro render_modal_header(type, title) %}
    <div class="modal-header {{ type }}-text center-align">
        {{ render_icon(type if type != "danger" else "error", classes="large") }}
        <h4 class="center-align">{{ title }}</h4>
        <div class="divider {{ type }} mt-2"></div>
    </div>
{% endmacro %}