{% extends 'menu/_base.html' %}

{% import 'macros/button.html' as Button %}
{% import 'components/_dropdown.html' as Dropdown %}

{% block main %}
    <section class="section">
        <div class="mx-4">
            <div class="card-panel">
                <div class="card-header">
                    <div class="flex-row space-between">
                        <h5>Categories <span class="counter">{{ categories|count if categories else '0' }}</span></h5>
                        {{ Button.render('Add Category', type='filled', icon='add') }}
                    </div>
                    <p class="mt-0">Manage menu categories here.</p>
                </div>
                <input type="hidden" name="status" value="{{ current_status }}">
                <input type="hidden" name="type" value="{{ current_type }}">
                <input type="hidden" name="sort" value="{{ current_sort }}">

                <div class="flex-row space-between">
                    <div class="input-field inline" style="margin: 0;">
                        <i class="material-symbols-rounded prefix">search</i>
                        <label for="search-categories"></label><input type="search"
                                                                      id="search-categories"
                                                                      name="q"
                                                                      value="{{ current_search }}"
                                                                      placeholder="Search categories..."
                                                                      hx-get="{{ url_for('menu.categories') }}"
                                                                      hx-trigger="input changed delay:300ms, search"
                                                                      hx-target="#categories-tbody"
                                                                      hx-include="[name='status'],[name='type'],[name='sort']"
                                                                      hx-push-url="true">
                    </div>
                    <div>
                        {{ Dropdown.trigger('filter-dropdown', icon='filter_list', label='Filter') }}
                        {% call Dropdown.render('filter-dropdown') %}
                            {{ Dropdown.header("Status") }}
                            {{ Dropdown.item("All", url_for('menu.categories', status='all', type=current_type, sort=current_sort), active=(current_status == 'all')) }}
                            {{ Dropdown.item("Active", url_for('menu.categories', status='active', type=current_type, sort=current_sort), active=(current_status == 'active')) }}
                            {{ Dropdown.item("Inactive", url_for('menu.categories', status='inactive', type=current_type, sort=current_sort), active=(current_status == 'inactive')) }}
                            {{ Dropdown.divider() }}
                            {{ Dropdown.header("Type") }}
                            {{ Dropdown.item("All", url_for('menu.categories', status=current_status, type='all', sort=current_sort), active=(current_type == 'all')) }}
                            {{ Dropdown.item("Top-level", url_for('menu.categories', status=current_status, type='top-level', sort=current_sort), active=(current_type == 'top-level')) }}
                            {{ Dropdown.item("Subcategories", url_for('menu.categories', status=current_status, type='subcategory', sort=current_sort), active=(current_type == 'subcategory')) }}
                        {% endcall %}

                        {{ Dropdown.trigger('sort-dropdown', icon='sort', label='Sort') }}
                        {% call Dropdown.render('sort-dropdown') %}
                            {{ Dropdown.item("Name A-Z", url_for('menu.categories', status=current_status, type=current_type, sort='name'), active=(current_sort == 'name')) }}
                            {{ Dropdown.item("Name Z-A", url_for('menu.categories', status=current_status, type=current_type, sort='-name'), active=(current_sort == '-name')) }}
                            {{ Dropdown.item("Display Order", url_for('menu.categories', status=current_status, type=current_type, sort='order'), active=(current_sort == 'order')) }}
                            {{ Dropdown.item("Status", url_for('menu.categories', status=current_status, type=current_type, sort='status'), active=(current_sort == 'status')) }}
                        {% endcall %}
                    </div>
                </div>
                <table class="highlight striped">
                    <thead>
                    <tr>
                        <th>Category Name</th>
                        <th>Items</th>
                        <th>Order</th>
                        <th>Status</th>
                        <th>Actions</th>
                    </tr>
                    </thead>
                    <tbody id="categories-tbody">
                        {% include 'menu/_categories_table.html' %}
                    </tbody>
                </table>
            </div>
        </div>
    </section>
{% endblock %}
