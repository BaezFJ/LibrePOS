{% extends 'menu/_base.html' %}

{% import 'macros/button.html' as Button %}
{% import 'macros/forms.html' as Forms %}
{% import 'macros/modals.html' as Modal %}
{% import 'components/_dropdown.html' as Dropdown %}
{% import 'macros/headers.html' as Header %}
{% import 'components/_footer.html' as Footer %}
{% import 'menu/macros/categories_card.html' as CategoryCard %}

{% block main %}
    {% call Header.page("Categories", count=categories|count) %}
        {{ Button.filled("Add Category", icon="add") }}
    {% endcall %}

    <section class="section">
        <div class="container">
            {# Filter and Sort Controls #}
            <div class="card-panel mb-6">
                <div class="row mb-0">
                    <div class="col s12 m4">
                        {{ Modal.trigger('searchModal', 'Search', 'search', 'elevated') }}
                    </div>
                    <div class="col s12 m8 flex flex-row justify-end gap-3">
                        {{ Dropdown.trigger('filter-dropdown', icon='filter_list', label='Filter', type_='text') }}
                        {% call Dropdown.render('filter-dropdown') %}
                            {{ Dropdown.header("Status") }}
                            {{ Dropdown.item("All", url_for('menu.categories', status='all', type=current_type, sort=current_sort), active=(current_status == 'all')) }}
                            {{ Dropdown.item("Active", url_for('menu.categories', status='active', type=current_type, sort=current_sort), active=(current_status == 'active')) }}
                            {{ Dropdown.item("Inactive", url_for('menu.categories', status='inactive', type=current_type, sort=current_sort), active=(current_status == 'inactive')) }}
                            {{ Dropdown.divider() }}
                            {{ Dropdown.header("Type") }}
                            {{ Dropdown.item("All", url_for('menu.categories', status=current_status, type='all', sort=current_sort), active=(current_type == 'all')) }}
                            {{ Dropdown.item("Top-level", url_for('menu.categories', status=current_status, type='top-level', sort=current_sort), active=(current_type == 'top-level')) }}
                            {{ Dropdown.item("Subcategories", url_for('menu.categories', status=current_status, type='subcategory', sort=current_sort), active=(current_type == 'subcategory')) }}
                        {% endcall %}

                        {{ Dropdown.trigger('sort-dropdown', icon='sort', label='Sort', type_='text') }}
                        {% call Dropdown.render('sort-dropdown') %}
                            {{ Dropdown.item("Name A-Z", url_for('menu.categories', status=current_status, type=current_type, sort='name'), active=(current_sort == 'name')) }}
                            {{ Dropdown.item("Name Z-A", url_for('menu.categories', status=current_status, type=current_type, sort='-name'), active=(current_sort == '-name')) }}
                            {{ Dropdown.item("Display Order", url_for('menu.categories', status=current_status, type=current_type, sort='order'), active=(current_sort == 'order')) }}
                            {{ Dropdown.item("Status", url_for('menu.categories', status=current_status, type=current_type, sort='status'), active=(current_sort == 'status')) }}
                        {% endcall %}
                    </div>
                </div>
            </div>

            {# Categories Grid #}
            {% if categories %}
                <div class="categories-grid">
                    {% for category in categories %}
                        {{ CategoryCard.render(category) }}
                    {% endfor %}
                </div>
            {% else %}
                <div class="card-panel center-align py-12">
                    <span class="material-symbols-rounded grey-text text-lighten-1" style="font-size: 64px;" aria-hidden="true">category</span>
                    <h5 class="grey-text text-darken-1 mt-4 mb-2">No categories yet</h5>
                    <p class="grey-text mb-6">Create your first category to start organizing your menu.</p>
                    {{ Button.filled("Add Category", icon="add", attrs={'data-target': 'addCategory', 'class': 'modal-trigger'}) }}
                </div>
            {% endif %}
        </div>
    </section>

    {{ Modal.search(
        modal_id='search',
        action=url_for('menu.categories', status=current_status, type=current_type, sort=current_sort),
        placeholder='Search categories...'
    ) }}

    {% call Modal.form_modal(
        modal_id='addCategory',
        title='Add Category',
        action=url_for('menu.categories'),
        submit_text='Create Category',
        enctype='multipart/form-data'
    ) %}
        {{ Forms.render(form, {'name': 'm12', 'description': 'm12', 'parent_id': 'm6', 'display_order': 'm6', 'is_active': 'm12'}) }}
    {% endcall %}
{% endblock %}

{% block footer %}
    {% call Footer.render() %}
        {{ Footer.item("") }}
    {% endcall %}
{% endblock %}
