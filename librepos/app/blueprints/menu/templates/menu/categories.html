{% extends 'menu/_base.html' %}

{% import 'macros/button.html' as Button %}
{% import 'macros/forms.html' as Forms %}
{% import 'macros/modals.html' as Modal %}
{% import 'components/_dropdown.html' as Dropdown %}
{% import 'macros/headers.html' as Header %}

{% block main %}
    {% call Header.page("Categories", count=categories|count) %}
        {{ Button.filled("Add Category", icon="add") }}
    {% endcall %}

    <section class="section">
        <div class="container">
            <div class="card-panel">
                <div class="row">
                    <div class="col s12 m4">
                        {{ Modal.trigger('searchModal', 'Search', 'search', 'elevated') }}
                    </div>
                    <div class="col s12 m8 flex flex-row justify-end gap-3">
                        {{ Dropdown.trigger('filter-dropdown', icon='filter_list', label='Filter', type_='text') }}
                        {% call Dropdown.render('filter-dropdown') %}
                            {{ Dropdown.header("Status") }}
                            {{ Dropdown.item("All", url_for('menu.categories', status='all', type=current_type, sort=current_sort), active=(current_status == 'all')) }}
                            {{ Dropdown.item("Active", url_for('menu.categories', status='active', type=current_type, sort=current_sort), active=(current_status == 'active')) }}
                            {{ Dropdown.item("Inactive", url_for('menu.categories', status='inactive', type=current_type, sort=current_sort), active=(current_status == 'inactive')) }}
                            {{ Dropdown.divider() }}
                            {{ Dropdown.header("Type") }}
                            {{ Dropdown.item("All", url_for('menu.categories', status=current_status, type='all', sort=current_sort), active=(current_type == 'all')) }}
                            {{ Dropdown.item("Top-level", url_for('menu.categories', status=current_status, type='top-level', sort=current_sort), active=(current_type == 'top-level')) }}
                            {{ Dropdown.item("Subcategories", url_for('menu.categories', status=current_status, type='subcategory', sort=current_sort), active=(current_type == 'subcategory')) }}
                        {% endcall %}

                        {{ Dropdown.trigger('sort-dropdown', icon='sort', label='Sort', type_='text') }}
                        {% call Dropdown.render('sort-dropdown') %}
                            {{ Dropdown.item("Name A-Z", url_for('menu.categories', status=current_status, type=current_type, sort='name'), active=(current_sort == 'name')) }}
                            {{ Dropdown.item("Name Z-A", url_for('menu.categories', status=current_status, type=current_type, sort='-name'), active=(current_sort == '-name')) }}
                            {{ Dropdown.item("Display Order", url_for('menu.categories', status=current_status, type=current_type, sort='order'), active=(current_sort == 'order')) }}
                            {{ Dropdown.item("Status", url_for('menu.categories', status=current_status, type=current_type, sort='status'), active=(current_sort == 'status')) }}
                        {% endcall %}
                    </div>
                </div>
                <div class="flex flex-row items-center justify-between">

                </div>
                <table class="highlight striped sticky-header">
                    <thead>
                    <tr>
                        <th scope="col" class="sortable sort-asc" tabindex="0" role="button" aria-sort="ascending">
                            Category Name
                            <span class="material-symbols-rounded" aria-hidden="true">arrow_upward</span>
                        </th>
                        <th scope="col">Description</th>
                        <th scope="col">Items</th>
                        <th scope="col" class="sortable" tabindex="0" role="button" aria-sort="none">
                            Order
                            <span class="material-symbols-rounded" aria-hidden="true">arrow_upward</span>
                        </th>
                        <th scope="col" class="sortable" tabindex="0" role="button" aria-sort="none">
                            Status
                            <span class="material-symbols-rounded" aria-hidden="true">arrow_upward</span>
                        </th>
                        <th scope="col">Actions</th>
                    </tr>
                    </thead>
                    <tbody>
                    {% for category in categories %}
                        <tr>
                            <td>{{ category.name }}</td>
                            <td>
                                {% if category.description %}
                                    {{ category.description }}
                                {% else %}
                                    <span class="grey-text">No description provided.</span>
                                {% endif %}
                            </td>
                            <td>N/A</td>
                            <td>{{ category.display_order }}</td>
                            <td>
                                {% if category.is_active %}
                                    <span class="success-text">Active</span>
                                {% else %}
                                    <span class="error-text">Inactive</span>
                                {% endif %}
                            </td>
                            <td>
                                {% set category_dropdown = category.id|string + '-dropdown' %}
                                {{ Dropdown.trigger(category_dropdown, label='More', type_='text') }}
                                {% call Dropdown.render(category_dropdown) %}
                                    {{ Dropdown.item('Edit') }}
                                    {{ Dropdown.item('Toggle Visibility') }}
                                    {{ Dropdown.item('Reorder') }}
                                    {{ Dropdown.item('Archive') }}
                                    {{ Dropdown.item('Delete') }}
                                {% endcall %}
                            </td>
                        </tr>
                    {% endfor %}

                    </tbody>
                </table>
            </div>
        </div>
    </section>

    {{ Modal.search(
        modal_id='search',
        action=url_for('menu.categories', status=current_status, type=current_type, sort=current_sort),
        placeholder='Search categories...'
    ) }}

    {% call Modal.form_modal(
        modal_id='addCategory',
        title='Add Category',
        action=url_for('menu.categories'),
        submit_text='Create Category',
        enctype='multipart/form-data'
    ) %}
        {{ Forms.render(form, {'name': 'm12', 'description': 'm12', 'parent_id': 'm6', 'display_order': 'm6', 'is_active': 'm12'}) }}
    {% endcall %}
{% endblock %}
