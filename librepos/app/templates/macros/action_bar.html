{# ==========================================================================
   ACTION BAR - Floating Action Bar Component
   ==========================================================================
   A floating pill-shaped action bar for common page actions.
   Positions at bottom-center of <main>, floating above content.

   Usage:
   {% import 'macros/action_bar.html' as ActionBar %}

   Option 1: Standard actions with parameters
   {{ ActionBar.render(
       create_modal='createItemModal',
       search_modal='searchModal',
       filter_dropdown='filter-dropdown',
       sort_dropdown='sort-dropdown'
   ) }}

   Option 2: Custom actions with caller
   {% call ActionBar.render(id='custom-actions') %}
       {{ ActionBar.item('Custom', icon='star', url='#') }}
       {{ ActionBar.divider() }}
       {{ ActionBar.item('Export', icon='download', modal='exportModal') }}
   {% endcall %}
   ========================================================================== #}


{# ---------- Helper Macros ---------- #}

{% macro _icon(name) -%}
    <i class="material-symbols-rounded" aria-hidden="true">{{ name }}</i>
{%- endmacro %}


{# ---------- Action Item ---------- #}
{% macro item(label, icon, url=None, modal=None, dropdown=None, _class='') %}
{#
    Renders a single action item in the bar.

    Args:
        label: Text label for the action
        icon: Material Symbols icon name
        url: Link URL (mutually exclusive with modal/dropdown)
        modal: Modal ID to trigger via popover API
        dropdown: Dropdown ID for MaterializeCSS dropdown
        _class: Additional CSS classes
#}
    <button type="button"
            class="action-bar-item btn-flat waves-effect{{ ' dropdown-trigger' if dropdown }}{{ ' ' ~ _class if _class }}"
            {% if dropdown %}data-target="{{ dropdown }}"{% endif %}
            {% if modal %}popovertarget="{{ modal }}"{% endif %}
            {% if not modal and not dropdown and url %}onclick="window.location.href='{{ url }}'"{% endif %}
            title="{{ label }}">
        {{ _icon(icon) }}
        <span class="action-bar-label">{{ label }}</span>
    </button>
{% endmacro %}


{# ---------- Divider ---------- #}
{% macro divider() %}
    <span class="action-bar-divider" aria-hidden="true"></span>
{% endmacro %}


{# ---------- Main Render Macro ---------- #}
{% macro render(
    id='action-bar',
    create_label='Create',
    create_icon='add',
    create_url=None,
    create_modal=None,
    filter_label='Filter',
    filter_icon='filter_list',
    filter_dropdown=None,
    filter_url=None,
    sort_label='Sort',
    sort_icon='sort',
    sort_dropdown=None,
    sort_url=None,
    search_label='Search',
    search_icon='search',
    search_modal=None,
    search_url=None,
    _class=''
) %}
{#
    Renders the floating action bar with standard actions.

    Args:
        id: Unique ID for the action bar container
        create_*: Create action config (label, icon, url or modal)
        filter_*: Filter action config (label, icon, dropdown or url)
        sort_*: Sort action config (label, icon, dropdown or url)
        search_*: Search action config (label, icon, modal or url)
        _class: Additional CSS classes for the container

    If caller() is provided, custom items replace standard ones.
#}
    <div id="{{ id }}" class="action-bar{{ ' ' ~ _class if _class }}" role="toolbar" aria-label="Page actions">
        <div class="action-bar-inner">
            {% if caller is defined %}
                {{ caller() }}
            {% else %}
                {# Standard actions: Create, Filter, Sort, Search #}
                {% if create_url or create_modal %}
                    {{ item(create_label, create_icon, url=create_url, modal=create_modal) }}
                {% endif %}

                {% if filter_dropdown or filter_url %}
                    {{ item(filter_label, filter_icon, url=filter_url, dropdown=filter_dropdown) }}
                {% endif %}

                {% if sort_dropdown or sort_url %}
                    {{ item(sort_label, sort_icon, url=sort_url, dropdown=sort_dropdown) }}
                {% endif %}

                {% if search_modal or search_url %}
                    {{ item(search_label, search_icon, url=search_url, modal=search_modal) }}
                {% endif %}
            {% endif %}
        </div>
    </div>
{% endmacro %}
