{#
    Dropdown Component
    ==================
    MaterializeCSS dropdown menu component with support for icons, badges,
    headers, and dividers.

    Import:
        {% import "components/_dropdown.html" as Dropdown %}

    Basic Usage:
        {{ Dropdown.trigger("my-dropdown") }}

        {% call Dropdown.render("my-dropdown") %}
            {{ Dropdown.item("Edit", url_for("edit"), icon="edit") }}
            {{ Dropdown.item("Delete", url_for("delete"), icon="delete", class_="red-text") }}
        {% endcall %}

    Button Types:
        {{ Dropdown.trigger("menu", type_="tonal") }}
        {{ Dropdown.trigger("menu", type_="filled") }}
        {{ Dropdown.trigger("menu", type_="outlined") }}
        {{ Dropdown.trigger("menu", type_="text") }}
        {{ Dropdown.trigger("menu", type_="elevated") }}

    With Sections:
        {% call Dropdown.render("user-menu") %}
            {{ Dropdown.header("Account") }}
            {{ Dropdown.item("Profile", "#", icon="person") }}
            {{ Dropdown.item("Settings", "#", icon="settings") }}
            {{ Dropdown.divider() }}
            {{ Dropdown.header("Notifications") }}
            {{ Dropdown.item("Messages", "#", icon="mail", badge=3) }}
            {{ Dropdown.divider() }}
            {{ Dropdown.item("Logout", "#", icon="logout", class_="red-text") }}
        {% endcall %}

    Item States:
        {{ Dropdown.item("Current Page", "#", active=True) }}
        {{ Dropdown.item("Unavailable", "#", disabled=True) }}

    App Tile Grid:
        {% call Dropdown.render("apps-menu") %}
            {{ Dropdown.tile("dashboard", "Dashboard", url_for("dashboard")) }}
            {{ Dropdown.tile("inventory", "Inventory", url_for("inventory")) }}
        {% endcall %}

    Note: Requires MaterializeCSS dropdown initialization in JavaScript:
        M.Dropdown.init(document.querySelectorAll('.dropdown-trigger'));
#}

{% import 'macros/button.html' as Button %}
{% import 'macros/icon.html' as Icon %}
{% import 'macros/badge.html' as Badge %}


{# ==========================================================================
   CONTAINER
   ========================================================================== #}

{# render(id, class_='')
   ---------------------
   Creates the dropdown container element.

   Parameters:
       id     (str): Required. Unique identifier matching the trigger's data-target.
       class_ (str): Optional. Additional CSS classes for the dropdown.

   Usage: Must be called with {% call %} to inject content via {{ caller() }}.
#}
{% macro render(id, class_='') %}
    <ul id="{{ id }}" class="dropdown-content{% if class_ %} {{ class_ }}{% endif %}">
        {{ caller() }}
    </ul>
{% endmacro %}


{# ==========================================================================
   TRIGGER
   ========================================================================== #}

{# trigger(id, icon='more_vert', label=None, type_='tonal', class_='')
   ---------------------------------------------------------------------
   Creates a button that opens the dropdown when clicked.

   Parameters:
       id     (str): Required. Must match the dropdown's id attribute.
       icon   (str): Optional. Material Symbols icon name. Defaults to 'more_vert'.
       label  (str): Optional. Text label (hidden on medium screens and below).
       type_  (str): Optional. Button type: 'tonal', 'filled', 'outlined', 'text', 'elevated'.
                     Defaults to 'tonal'.
       class_ (str): Optional. Additional CSS classes.

   Note: Label is hidden on medium screens and below (hide-on-med-and-down).
         Also serves as the aria-label for accessibility.
#}
{% macro trigger(id, icon='more_vert', label=None, type_='tonal', class_='') -%}
    {% set aria = label if label else id|replace("-", " ") %}
    <a href="#"
       class="btn {{ type_ }} waves-effect dropdown-trigger{% if class_ %} {{ class_ }}{% endif %}"
       data-target="{{ id }}"
       aria-label="{{ aria }}">
        {{ Icon.render(icon) }}
        {% if label %}
            <span class="hide-on-med-and-down">&nbsp;{{ label }}</span>
        {% endif %}
    </a>
{%- endmacro %}


{# ==========================================================================
   MENU ITEMS
   ========================================================================== #}

{# item(label, url='#', icon=None, badge=None, disabled=False, active=False, class_='')
   -------------------------------------------------------------------------------------
   Creates a dropdown menu item.

   Parameters:
       label    (str):  Required. Text displayed for the menu item.
       url      (str):  Optional. Destination URL when clicked. Defaults to '#'.
       icon     (str):  Optional. Material Symbols icon shown before label.
       badge    (int):  Optional. Notification count displayed after label.
       disabled (bool): Optional. Disabled state. Defaults to False.
       active   (bool): Optional. Active/selected state. Defaults to False.
       class_   (str):  Optional. Additional CSS classes (e.g., "red-text").
#}
{% macro item(label, url='#', icon=None, badge=None, disabled=False, active=False, class_='') -%}
    <li{% if active %} class="active"{% endif %}>
        <a href="{{ url }}"
           class="waves-effect waves-light{% if class_ %} {{ class_ }}{% endif %}"
           {% if disabled %}aria-disabled="true" tabindex="-1"{% endif %}>
            {%- if icon %}
                {{ Icon.render(icon) }}
            {%- endif %}
            {{ label }}
            {%- if badge %}
                {{ Badge.count(badge) }}
            {%- endif %}
        </a>
    </li>
{%- endmacro %}


{# header(text, class_='')
   -----------------------
   Creates a section header for grouping menu items.

   Parameters:
       text   (str): Required. Header text.
       class_ (str): Optional. Additional CSS classes.
#}
{% macro header(text, class_='') -%}
    <div class="text-lg font-bold tracking-wide{% if class_ %} {{ class_ }}{% endif %}">
        <span>{{ text }}</span>
    </div>
{%- endmacro %}


{# divider()
   ---------
   Adds a horizontal separator line between menu items.
#}
{% macro divider() -%}
    <li class="divider" tabindex="-1"></li>
{%- endmacro %}


{# ==========================================================================
   APP TILES
   ========================================================================== #}

{# tile(icon, label=None, url='#', class_='')
   ------------------------------------------
   Creates an app-tile style link for grid-based dropdown menus.

   Parameters:
       icon   (str): Required. Material Symbols icon name.
       label  (str): Optional. Text label displayed below the icon.
       url    (str): Optional. Destination URL for the tile. Defaults to '#'.
       class_ (str): Optional. Additional CSS classes.
#}
{% macro tile(icon, label=None, url='#', class_='') -%}
    <li>
        <a href="{{ url }}" class="app-tile{% if class_ %} {{ class_ }}{% endif %}">
            {{ Icon.render(icon) }}
            {%- if label %}
                <span>{{ label }}</span>
            {%- endif %}
        </a>
    </li>
{%- endmacro %}
